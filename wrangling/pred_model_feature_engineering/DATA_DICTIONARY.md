# SPLG Feature-Engineered Dataset: Data Dictionary

**Dataset**: `rich_features_SPLG_history_full.csv`  
**Records**: 4,748  
**Columns**: 115  
**Date Range**: 2006-09-01 to 2025-09-24  
**Source**: SPLG (SPDR Portfolio S&P 500 ETF) daily price data  
**Generated by**: `build_splg_features.py`

---

## Column Index

| # | Column Name | Data Type | Category | Description |
|---|-------------|-----------|----------|-------------|
| 1 | date | object | Metadata | Trading date (YYYY-MM-DD) |
| 2 | company_name | object | Metadata | ETF name: "SPDR Portfolio S&P 500 ETF" |
| 3 | ticker | object | Metadata | Ticker symbol: "SPLG" |
| 4 | current_price | float64 | Original | Current/latest price |
| 5 | open | float64 | Original | Opening price |
| 6 | close | float64 | Original | Closing price |
| 7 | high | float64 | Original | Highest intraday price |
| 8 | low | float64 | Original | Lowest intraday price |
| 9 | volume | int64 | Original | Trading volume (shares) |
| 10 | pe_ratio | float64 | Original | Price-to-earnings ratio |
| 11 | yield | float64 | Original | Dividend yield (%) |
| 12 | high_low_spread | float64 | Price | High - Low |
| 13 | high_low_pct | float64 | Price | (High - Low) / Close |
| 14 | close_open_diff | float64 | Price | Close - Open (intraday change) |
| 15 | close_open_pct | float64 | Price | (Close - Open) / Open |
| 16 | high_close_diff | float64 | Price | High - Close |
| 17 | low_close_diff | float64 | Price | Low - Close |
| 18 | close_current_price_diff | float64 | Price | Close - Current Price |
| 19 | return_1d | float64 | Return | 1-day % return |
| 20 | log_return | float64 | Return | ln(Close_t / Close_{t-1}) |
| 21 | return_5d | float64 | Return | 5-day % return |
| 22 | return_10d | float64 | Return | 10-day % return |
| 23 | return_20d | float64 | Return | 20-day % return |
| 24 | rolling_mean_return_5d | float64 | Return | 5-day MA of daily returns |
| 25 | rolling_mean_return_20d | float64 | Return | 20-day MA of daily returns |
| 26 | ma_5 | float64 | Trend | 5-day simple moving average |
| 27 | ema_5 | float64 | Trend | 5-day exponential moving average |
| 28 | price_ma_5_ratio | float64 | Trend | Close / MA_5 |
| 29 | ma_5_slope | float64 | Trend | Rate of change of MA_5 |
| 30 | ma_10 | float64 | Trend | 10-day simple moving average |
| 31 | ema_10 | float64 | Trend | 10-day exponential moving average |
| 32 | price_ma_10_ratio | float64 | Trend | Close / MA_10 |
| 33 | ma_10_slope | float64 | Trend | Rate of change of MA_10 |
| 34 | ma_20 | float64 | Trend | 20-day simple moving average |
| 35 | ema_20 | float64 | Trend | 20-day exponential moving average |
| 36 | price_ma_20_ratio | float64 | Trend | Close / MA_20 |
| 37 | ma_20_slope | float64 | Trend | Rate of change of MA_20 |
| 38 | ma_50 | float64 | Trend | 50-day simple moving average |
| 39 | ema_50 | float64 | Trend | 50-day exponential moving average |
| 40 | price_ma_50_ratio | float64 | Trend | Close / MA_50 |
| 41 | ma_50_slope | float64 | Trend | Rate of change of MA_50 |
| 42 | ma_100 | float64 | Trend | 100-day simple moving average |
| 43 | ema_100 | float64 | Trend | 100-day exponential moving average |
| 44 | price_ma_100_ratio | float64 | Trend | Close / MA_100 |
| 45 | ma_100_slope | float64 | Trend | Rate of change of MA_100 |
| 46 | ma_200 | float64 | Trend | 200-day simple moving average |
| 47 | ema_200 | float64 | Trend | 200-day exponential moving average |
| 48 | price_ma_200_ratio | float64 | Trend | Close / MA_200 |
| 49 | ma_200_slope | float64 | Trend | Rate of change of MA_200 |
| 50 | ma_cross_10_over_50 | int64 | Trend | Binary: 1 if MA_10 > MA_50 |
| 51 | ma_cross_20_over_50 | int64 | Trend | Binary: 1 if MA_20 > MA_50 |
| 52 | ma_cross_50_over_200 | int64 | Trend | Binary: 1 if MA_50 > MA_200 (Golden Cross) |
| 53 | momentum_5 | float64 | Momentum | Close_t - Close_{t-5} |
| 54 | momentum_10 | float64 | Momentum | Close_t - Close_{t-10} |
| 55 | roc_10 | float64 | Momentum | 10-day rate of change |
| 56 | rsi_14 | float64 | Momentum | 14-day Relative Strength Index (0-100) |
| 57 | macd | float64 | Momentum | MACD line: EMA(12) - EMA(26) |
| 58 | macd_signal | float64 | Momentum | MACD signal: EMA(9) of MACD |
| 59 | macd_hist | float64 | Momentum | MACD histogram: MACD - Signal |
| 60 | rolling_std_5 | float64 | Volatility | 5-day rolling std dev |
| 61 | rolling_var_5 | float64 | Volatility | 5-day rolling variance |
| 62 | rolling_std_10 | float64 | Volatility | 10-day rolling std dev |
| 63 | rolling_var_10 | float64 | Volatility | 10-day rolling variance |
| 64 | rolling_std_20 | float64 | Volatility | 20-day rolling std dev |
| 65 | rolling_var_20 | float64 | Volatility | 20-day rolling variance |
| 66 | rolling_std_30 | float64 | Volatility | 30-day rolling std dev |
| 67 | rolling_var_30 | float64 | Volatility | 30-day rolling variance |
| 68 | atr_14 | float64 | Volatility | 14-day Average True Range |
| 69 | bb_upper_20 | float64 | Volatility | Upper Bollinger Band (MA + 2×STD) |
| 70 | bb_lower_20 | float64 | Volatility | Lower Bollinger Band (MA - 2×STD) |
| 71 | bb_pct_20 | float64 | Volatility | Bollinger Band %: (Close - Lower) / (Upper - Lower) |
| 72 | vol_change | float64 | Volume | % change in volume from previous day |
| 73 | vol_ma_5 | float64 | Volume | 5-day moving average of volume |
| 74 | vol_ma_20 | float64 | Volume | 20-day moving average of volume |
| 75 | vol_ratio_5_20 | float64 | Volume | Ratio: MA_5(Volume) / MA_20(Volume) |
| 76 | obv | float64 | Volume | On-Balance Volume (cumulative) |
| 77 | vpt | float64 | Volume | Volume Price Trend |
| 78 | lag_1_close | float64 | Lag | Close price 1 day ago |
| 79 | lag_1_return | float64 | Lag | Return 1 day ago |
| 80 | lag_1_volume | float64 | Lag | Volume 1 day ago |
| 81 | lag_2_close | float64 | Lag | Close price 2 days ago |
| 82 | lag_2_return | float64 | Lag | Return 2 days ago |
| 83 | lag_2_volume | float64 | Lag | Volume 2 days ago |
| 84 | lag_3_close | float64 | Lag | Close price 3 days ago |
| 85 | lag_3_return | float64 | Lag | Return 3 days ago |
| 86 | lag_3_volume | float64 | Lag | Volume 3 days ago |
| 87 | lag_5_close | float64 | Lag | Close price 5 days ago |
| 88 | lag_5_return | float64 | Lag | Return 5 days ago |
| 89 | lag_5_volume | float64 | Lag | Volume 5 days ago |
| 90 | lag_10_close | float64 | Lag | Close price 10 days ago |
| 91 | lag_10_return | float64 | Lag | Return 10 days ago |
| 92 | lag_10_volume | float64 | Lag | Volume 10 days ago |
| 93 | rolling_mean_close_10 | float64 | Rolling Stats | 10-day mean of close prices |
| 94 | rolling_max_10 | float64 | Rolling Stats | 10-day maximum close |
| 95 | rolling_min_10 | float64 | Rolling Stats | 10-day minimum close |
| 96 | rolling_skew_10 | float64 | Rolling Stats | 10-day skewness of close |
| 97 | rolling_kurt_10 | float64 | Rolling Stats | 10-day kurtosis of close |
| 98 | rolling_mean_close_20 | float64 | Rolling Stats | 20-day mean of close prices |
| 99 | rolling_max_20 | float64 | Rolling Stats | 20-day maximum close |
| 100 | rolling_min_20 | float64 | Rolling Stats | 20-day minimum close |
| 101 | rolling_skew_20 | float64 | Rolling Stats | 20-day skewness of close |
| 102 | rolling_kurt_20 | float64 | Rolling Stats | 20-day kurtosis of close |
| 103 | rolling_mean_close_30 | float64 | Rolling Stats | 30-day mean of close prices |
| 104 | rolling_max_30 | float64 | Rolling Stats | 30-day maximum close |
| 105 | rolling_min_30 | float64 | Rolling Stats | 30-day minimum close |
| 106 | rolling_skew_30 | float64 | Rolling Stats | 30-day skewness of close |
| 107 | rolling_kurt_30 | float64 | Rolling Stats | 30-day kurtosis of close |
| 108 | dow | int64 | Calendar | Day of week (0=Mon, 6=Sun) |
| 109 | month | int64 | Calendar | Month (1-12) |
| 110 | quarter | int64 | Calendar | Quarter (1-4) |
| 111 | year | int64 | Calendar | Year (2006-2025) |
| 112 | is_month_start | int64 | Calendar | Binary: 1 if first trading day of month |
| 113 | is_month_end | int64 | Calendar | Binary: 1 if last trading day of month |
| 114 | target_close_t1 | float64 | **TARGET** | **Next day's closing price** |
| 115 | target_return_t1 | float64 | **TARGET** | **Next day's % return** |

---

## Feature Category Summary

| Category | Count | Data Types | Purpose |
|----------|-------|------------|---------|
| Metadata | 3 | object | Identification (date, company, ticker) |
| Original Price/Volume | 8 | float64, int64 | Raw market data (OHLCV + fundamentals) |
| Price Relationships | 7 | float64 | Intraday price dynamics |
| Returns | 7 | float64 | Historical and rolling returns |
| Trend (Moving Averages) | 30 | float64, int64 | SMAs, EMAs, ratios, slopes, crosses |
| Momentum | 7 | float64 | RSI, MACD, ROC, momentum |
| Volatility | 13 | float64 | Std dev, variance, ATR, Bollinger Bands |
| Volume | 6 | float64 | Volume indicators (OBV, VPT, MAs) |
| Lagged Features | 15 | float64 | Autoregressive signals (1-10 days) |
| Rolling Statistics | 15 | float64 | Distribution shape (mean, max, min, skew, kurt) |
| Calendar | 8 | int64 | Temporal features (day, month, year, etc.) |
| **Targets** | 2 | float64 | **Next-day price and return** |
| **TOTAL** | **115** | | |

---

## Feature Engineering Notes

### Missing Value Handling
- **Beta column**: Completely removed (100% NaN in source data)
- **All other columns**: Complete (no NaN values after processing)
- **Records lost**: 248 rows (from 4,996 to 4,748) due to:
  - 200-day MA warm-up period
  - 30-day rolling statistic windows
  - Forward shift for target variable (loses last row)

### Temporal Dependencies
- **Lookback windows**: Up to 200 days for moving averages
- **Forward shift**: Target variables shifted -1 (next day)
- **Chronological integrity**: Maintained throughout (sorted by date)

### Data Types
- **float64** (97 columns): All continuous features and targets
- **int64** (15 columns): Volume, binary indicators, calendar features
- **object** (3 columns): Date, company name, ticker

### Scaling Considerations
- **Features are NOT scaled** in the dataset
- **Wide value ranges**: e.g., volume (0-millions), prices ($7-$78), ratios (0-2)
- **Recommendation**: Apply StandardScaler or MinMaxScaler during model training
- **Exception**: Tree-based models (GBR, Random Forest) don't require scaling

---

## Target Variable Details

### target_close_t1
- **Type**: Absolute price prediction
- **Range**: $7.9375 - $78.6800
- **Mean**: $30.4897
- **Use case**: Direct price forecasting
- **Metric**: RMSE in dollars

### target_return_t1 (RECOMMENDED)
- **Type**: Percentage return prediction
- **Range**: -11.68% to +9.53%
- **Mean**: +0.039% (daily)
- **Use case**: Return forecasting, directional trading
- **Metrics**: RMSE (%), directional accuracy (%)
- **Advantage**: Scale-invariant, more stationary than prices

---

## Feature Selection Recommendations

### High-Priority Features (Expected Importance)
Based on financial theory and time series forecasting:

1. **Lagged returns** (lag_1_return, lag_2_return, etc.)
2. **Recent price momentum** (momentum_5, momentum_10)
3. **RSI** (rsi_14) - oversold/overbought indicator
4. **MACD** (macd, macd_hist) - trend and momentum
5. **Volatility** (rolling_std_20, atr_14) - risk measure
6. **Moving average ratios** (price_ma_X_ratio) - trend strength
7. **Volume trends** (vol_ratio_5_20, obv) - conviction

### Potentially Redundant Features
Consider removing during feature selection:
- Both MA and EMA for same window (highly correlated)
- Both variance and std dev (redundant: var = std²)
- Multiple lag periods if only recent history matters

### Categorical/Binary Features
- **MA cross signals**: ma_cross_10_over_50, ma_cross_20_over_50, ma_cross_50_over_200
- **Calendar**: dow, month, quarter, is_month_start, is_month_end
- These can be used as-is or one-hot encoded

---

## Data Quality Checks

### Pre-Training Validation Checklist

```python
import pandas as pd
import numpy as np

df = pd.read_csv('data_out/rich_features_SPLG_history_full.csv')

# 1. Shape check
assert df.shape == (4748, 115), f"Expected (4748, 115), got {df.shape}"

# 2. No missing values
assert df.isna().sum().sum() == 0, "Dataset contains NaN values"

# 3. Date ordering
dates = pd.to_datetime(df['date'])
assert dates.is_monotonic_increasing, "Dates not in chronological order"

# 4. Target range check
assert df['target_return_t1'].abs().max() < 0.5, "Extreme returns detected"

# 5. Feature dtype check
float_cols = df.select_dtypes(include='float64').columns
int_cols = df.select_dtypes(include='int64').columns
obj_cols = df.select_dtypes(include='object').columns
assert len(float_cols) == 97, f"Expected 97 float64 columns, got {len(float_cols)}"
assert len(int_cols) == 15, f"Expected 15 int64 columns, got {len(int_cols)}"
assert len(obj_cols) == 3, f"Expected 3 object columns, got {len(obj_cols)}"

print("✅ All data quality checks passed!")
```

---

## Usage Example

```python
import pandas as pd

# Load dataset
df = pd.read_csv('data_out/rich_features_SPLG_history_full.csv')

# Separate by category
metadata = df[['date', 'company_name', 'ticker']]
targets = df[['target_close_t1', 'target_return_t1']]

# Get feature columns by category
price_features = [col for col in df.columns if 'high' in col or 'low' in col or 'open' in col or 'spread' in col or 'diff' in col]
trend_features = [col for col in df.columns if 'ma_' in col or 'ema_' in col or 'cross' in col]
momentum_features = [col for col in df.columns if 'momentum' in col or 'rsi' in col or 'macd' in col or 'roc' in col]
volatility_features = [col for col in df.columns if 'std' in col or 'var' in col or 'atr' in col or 'bb_' in col]
volume_features = [col for col in df.columns if 'vol' in col or 'obv' in col or 'vpt' in col]
lag_features = [col for col in df.columns if 'lag_' in col]
rolling_features = [col for col in df.columns if 'rolling_' in col]
calendar_features = ['dow', 'month', 'quarter', 'year', 'is_month_start', 'is_month_end']

# All feature columns
all_features = [col for col in df.columns if col not in ['date', 'company_name', 'ticker', 'target_close_t1', 'target_return_t1']]

print(f"Total features: {len(all_features)}")
```

---

## References

- **Source Script**: `build_splg_features.py`
- **Training Guide**: `GBR_MODEL_TRAINING_GUIDE.md`
- **Quick Start**: `QUICK_START_MODEL_TRAINING.md`

---

**Document Version**: 1.0  
**Last Updated**: October 14, 2025  
**Maintainer**: FEURCast Team
